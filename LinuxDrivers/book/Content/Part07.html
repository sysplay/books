<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Generic Hardware Access in Linux | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.6">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../Content/Part08.html" />
    
    
    <link rel="prev" href="../Content/Part06.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="7"
        data-chapter-title="Generic Hardware Access in Linux"
        data-filepath="Content/Part07.md"
        data-basepath=".."
        data-revision="Thu Oct 27 2016 14:08:48 GMT+0300 (AST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Preface
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Content/Part01.html">
            
                
                    <a href="../Content/Part01.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Linux Device Drivers for Your Girl Friend
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Content/Part02.html">
            
                
                    <a href="../Content/Part02.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Writing Your First Linux Driver in the Classroom
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Content/Part03.html">
            
                
                    <a href="../Content/Part03.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Kernel C Extras in a Linux Driver
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Content/Part04.html">
            
                
                    <a href="../Content/Part04.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Linux Character Drivers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Content/Part05.html">
            
                
                    <a href="../Content/Part05.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Character Device Files - Creation &amp; Operations
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Content/Part06.html">
            
                
                    <a href="../Content/Part06.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Decoding Character Device File Operations
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="7" data-path="Content/Part07.html">
            
                
                    <a href="../Content/Part07.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Generic Hardware Access in Linux
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Content/Part08.html">
            
                
                    <a href="../Content/Part08.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Accessing x86-Specific I/O-Mapped Hardware
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Content/Part09.html">
            
                
                    <a href="../Content/Part09.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        I/O Control in Linux
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Content/Part10.html">
            
                
                    <a href="../Content/Part10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Kernel-Space Debuggers in Linux
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="Content/Part11.html">
            
                
                    <a href="../Content/Part11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        USB Drivers in Linux
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="Content/Part12.html">
            
                
                    <a href="../Content/Part12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        USB Drivers in Linux Continued
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="Content/Part13.html">
            
                
                    <a href="../Content/Part13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Data Transfer to and from USB Devices
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="Content/Part14.html">
            
                
                    <a href="../Content/Part14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        A Dive Inside the Hard Disk for Understanding Partitions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="Content/Part15.html">
            
                
                    <a href="../Content/Part15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Disk on RAM: Playing with Block Drivers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="Content/Part16.html">
            
                
                    <a href="../Content/Part16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Kernel Window - Peeping through /proc
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="Content/Part17.html">
            
                
                    <a href="../Content/Part17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        Module Interactions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="Content/Part18.html">
            
                
                    <a href="../Content/Part18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        File Systems - A Semester Project
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="Content/Part19.html">
            
                
                    <a href="../Content/Part19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        File Systems: A Semester Project - II
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="Content/Part20.html">
            
                
                    <a href="../Content/Part20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        The Semester Project: File Systems - III
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="Content/Part21.html">
            
                
                    <a href="../Content/Part21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        The Semester Project - IV: FS Formatting a Pen Drive
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="Content/Part22.html">
            
                
                    <a href="../Content/Part22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        The Semester Project - V: The File System Module Template
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="Content/Part23.html">
            
                
                    <a href="../Content/Part23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        The Semester Project - VI: File System on Block Device
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="Content/Part24.html">
            
                
                    <a href="../Content/Part24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        The Semester Project - VII: The File System in Action
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="generic-hardware-access-in-linux">Generic Hardware Access in Linux</h1>
<blockquote>
<p>This seventh article, which is part of the series on Linux device drivers, talks about accessing hardware in Linux.</p>
</blockquote>
<p>Shweta was all jubilant about her character driver achievements, as she entered the Linux device drivers laboratory on the second floor of her college. Why not? Many of her classmates had already read her blog &amp; commented on her expertise. And today was a chance for show-off at an another level. Till now, it was all software. Today&#x2019;s lab was on accessing hardware in Linux. Students are expected to &#x201C;learn by experimentation&#x201D; to access various kinds of hardware in Linux on various architectures over multiple lab sessions here.</p>
<p>As usual, the lab staff are a bit skeptical to let the students directly get onto the hardware, without any background. So to build their background, they have prepared some slide presentations, which can be accessed from <a href="https://sysplay.in/index.php?pagefile=linux_drivers" target="_blank">SysPlay&#x2019;s website</a>.</p>
<h2 id="generic-hardware-interfacing">Generic hardware interfacing</h2>
<p>As every one settled in the laboratory, lab expert Priti started with the introduction to hardware interfacing in Linux. Skipping the theoretical details, the first interesting slide was about the generic architecture-transparent hardware interfacing. See Figure 11.</p>
<p><img src="../Images/Part7/figure_11_hardware_mapping.png" alt="Figure 11"></p>
<p>The basic assumption being that the architecture is 32-bit. For others, the memory map would change accordingly. For 32-bit address bus, the address/memory map ranges from 0 <code>(0x00000000)</code> to &#x2018;232 &#x2013; 1&#x2032; <code>(0xFFFFFFFF)</code>. And an architecture independent layout of this memory map would be as shown in the Figure 11 &#x2013; memory (RAM) and device regions (registers &amp; memories of devices) mapped in an interleaved fashion. The architecture dependent thing would be what these addresses are actually there. For example, in an x86 architecture, the initial 3GB <code>(0x00000000 to 0xBFFFFFFF)</code> is typically for RAM and the later 1GB <code>(0xC0000000 to 0xFFFFFFFF)</code>for device maps. However, if the RAM is less, say 2GB, device maps could start from 2GB <code>(0x80000000)</code>.</p>
<p>Type in <code>cat /proc/iomem</code> to list the memory map on your system. <code>cat /proc/meminfo</code> would give you an approximate RAM size on your system. Refer to Figure 12 for a snapshot.</p>
<p><img src="../Images/Part7/figure_12_phys_n_bus_addresses.png" alt="Figure 12"></p>
<p>Irrespective of the actual values, the addresses referring to RAM are termed as physical addresses. And the addresses referring to device maps are termed as bus addresses, as these devices are always mapped through some architecture-specific bus. For example, PCI bus in x86 architecture, AMBA bus in ARM architectures, SuperHyway bus in SuperH (or SH) architectures, GX bus on PowerPC (or PPC), etc.</p>
<p>All the architecture dependent values of these physical and bus addresses are either dynamically configurable or are to be obtained from the datasheets (i.e. hardware manuals) of the corresponding architecture processors/controllers. But the interesting part is that, in Linux none of these are directly accessible but are to be mapped to virtual addresses and then accessed through that. Thus, making the RAM and device accesses generic enough, except just mapping them to virtual addresses. And the corresponding APIs for mapping &amp; unmapping the device bus addresses to virtual addresses are:</p>
<pre><code class="lang-C"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/io.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">ioremap</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> device_bus_address, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> device_region_size)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">iounmap</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *virt_addr)</span></span>;
</code></pre>
<p>These are prototyped in <code>&lt;asm/io.h&gt;</code>. Once mapped to virtual addresses, it boils down to the device datasheet, as to which set of device registers and/or device memory to read from or write into, by adding their offsets to the virtual address returned by <code>ioremap()</code>. For that, the following are the APIs (prototyped in the same header file <code>&lt;asm/io.h&gt;</code>):</p>
<pre><code class="lang-C"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/io.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ioread8</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *virt_addr)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ioread16</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *virt_addr)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ioread32</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *virt_addr)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">iowrite8</span><span class="hljs-params">(u8 value, <span class="hljs-keyword">void</span> *virt_addr)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">iowrite16</span><span class="hljs-params">(u16 value, <span class="hljs-keyword">void</span> *virt_addr)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">iowrite32</span><span class="hljs-params">(u32 value, <span class="hljs-keyword">void</span> *virt_addr)</span></span>;
</code></pre>
<h2 id="accessing-the-video-ram-of-dos-days">Accessing the video RAM of &#x201C;DOS&#x201D; days</h2>
<p>After this first set of information, students were directed for the live experiments. They were suggested to do an initial experiment with the video RAM of &#x201C;DOS&#x201D; days to understand the usage of the above APIs. Shweta got onto the system &#x2013; displayed the /proc/iomem window &#x2013; one very similar to as shown in Figure 12. From there, she got the video RAM address ranging from <code>0x000A0000</code> to <code>0x000BFFFF</code>. And with that she added the above APIs with appropriate parameters into the constructor and destructor of her already written null driver to convert it into a vram driver. Then, she added the user access to the video RAM through read &amp; write calls of the <code>vram driver</code>. Here&#x2019;s what she coded in the new file <code>video_ram.c</code>:</p>
<pre><code class="lang-C"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/version.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/types.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kdev_t.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/fs.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/device.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/cdev.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/uaccess.h&gt;</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/io.h&gt;</span></span>

<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> VRAM_BASE <span class="hljs-number">0x000A0000</span></span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> VRAM_SIZE <span class="hljs-number">0x00020000</span></span>

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> __iomem *vram;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">dev_t</span> first;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">struct</span> cdev c_dev;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-keyword">class</span> *cl;

<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">my_open</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *i, <span class="hljs-keyword">struct</span> file *f)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">my_close</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *i, <span class="hljs-keyword">struct</span> file *f)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-keyword">static</span> ssize_t <span class="hljs-title">my_read</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *f, <span class="hljs-keyword">char</span> __user *buf, size_t len, loff_t *off)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    u8 byte;

    <span class="hljs-keyword">if</span> (*off &gt;= VRAM_SIZE)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">if</span> (*off + len &gt; VRAM_SIZE)
    {
        len = VRAM_SIZE - *off;
    }
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i++)
    {
        byte = ioread8((u8 *)vram + *off + i);
        <span class="hljs-keyword">if</span> (copy_to_user(buf + i, &amp;byte, <span class="hljs-number">1</span>))
        {
            <span class="hljs-keyword">return</span> -EFAULT;
        }
    }
    *off += len;

    <span class="hljs-keyword">return</span> len;
}
<span class="hljs-function"><span class="hljs-keyword">static</span> ssize_t <span class="hljs-title">my_write</span><span class="hljs-params">(
        <span class="hljs-keyword">struct</span> file *f, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> __user *buf, size_t len, loff_t *off)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    u8 byte;

    <span class="hljs-keyword">if</span> (*off &gt;= VRAM_SIZE)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">if</span> (*off + len &gt; VRAM_SIZE)
    {
        len = VRAM_SIZE - *off;
    }
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i++)
    {
        <span class="hljs-keyword">if</span> (copy_from_user(&amp;byte, buf + i, <span class="hljs-number">1</span>))
        {
            <span class="hljs-keyword">return</span> -EFAULT;
        }
        iowrite8(byte, (u8 *)vram + *off + i);
    }
    *off += len;

    <span class="hljs-keyword">return</span> len;
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">struct</span> file_operations vram_fops =
{
    .owner = THIS_MODULE,
    .open = my_open,
    .release = my_close,
    .read = my_read,
    .write = my_write
};

<span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> __<span class="hljs-function">init <span class="hljs-title">vram_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> <span class="hljs-comment">/* Constructor */</span>
</span>{
    <span class="hljs-keyword">int</span> ret;
    <span class="hljs-keyword">struct</span> device *dev_ret;

    <span class="hljs-keyword">if</span> ((vram = ioremap(VRAM_BASE, VRAM_SIZE)) == <span class="hljs-literal">NULL</span>)
    {
        printk(KERN_ERR <span class="hljs-string">&quot;Mapping video RAM failed\n&quot;</span>);
        <span class="hljs-keyword">return</span> -ENOMEM;
    }
    <span class="hljs-keyword">if</span> ((ret = alloc_chrdev_region(&amp;first, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;vram&quot;</span>)) &lt; <span class="hljs-number">0</span>)
    {
        <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-keyword">if</span> (IS_ERR(cl = class_create(THIS_MODULE, <span class="hljs-string">&quot;chardrv&quot;</span>)))
    {
        unregister_chrdev_region(first, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> PTR_ERR(cl);
    }
    <span class="hljs-keyword">if</span> (IS_ERR(dev_ret = device_create(cl, <span class="hljs-literal">NULL</span>, first, <span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;vram&quot;</span>)))
    {
        class_destroy(cl);
        unregister_chrdev_region(first, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> PTR_ERR(dev_ret);
    }

    cdev_init(&amp;c_dev, &amp;vram_fops);
    <span class="hljs-keyword">if</span> ((ret = cdev_add(&amp;c_dev, first, <span class="hljs-number">1</span>)) &lt; <span class="hljs-number">0</span>)
    {
        device_destroy(cl, first);
        class_destroy(cl);
        unregister_chrdev_region(first, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> __<span class="hljs-function"><span class="hljs-built_in">exit</span> <span class="hljs-title">vram_exit</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> <span class="hljs-comment">/* Destructor */</span>
</span>{
    cdev_del(&amp;c_dev);
    device_destroy(cl, first);
    class_destroy(cl);
    unregister_chrdev_region(first, <span class="hljs-number">1</span>);
    iounmap(vram);
}

module_init(vram_init);
module_exit(vram_exit);

MODULE_LICENSE(<span class="hljs-string">&quot;GPL&quot;</span>);
MODULE_AUTHOR(<span class="hljs-string">&quot;Anil Kumar Pugalia &lt;email@sarika-pugs.com&gt;&quot;</span>);
MODULE_DESCRIPTION(<span class="hljs-string">&quot;Video RAM Driver&quot;</span>);
</code></pre>
<h2 id="summing-up">Summing up</h2>
<p>Then, Shweta repeated the following steps:</p>
<ul>
<li>Build the vram driver (video_ram.ko file) by running make with the same Makefile changed to build this driver.</li>
<li>Usual load of the driver using insmod video_ram.ko.</li>
<li>Usual write into <code>/dev/vram</code>, say using <code>echo -n &#x201C;0123456789&#x201D; &gt; /dev/vram</code>.</li>
<li>Read the <code>/dev/vram</code> contents using <code>xxd /dev/vram | less</code>. The usual <code>cat /dev/vram</code> also can be used but that would give all binary content. <code>xxd</code> shows them up as hexadecimal in centre with the corresponding ASCII along the right side.</li>
<li>Usual unload the driver using rmmod video_ram.</li>
</ul>
<p><em>Note 1:</em> Today&#x2019;s systems typically use separate video cards having their own video RAM. So, the video RAM used in the &#x201C;DOS days&#x201D;, i.e. the one mentioned in this article is unused and many a times not even present. Hence, playing around with it, is safe, without any effect on the system, or the display.</p>
<p><em>Note 2:</em> Moreover, if the video RAM is absent, the read/write may not be actually reading/writing, but just sending/receiving signals in the air. In such a case, writes would not do any change, and reads would keep on reading the same value &#x2013; thus <code>xxd</code> showing the same values.</p>
<p>It was yet half an hour left for the practical class to be over and a lunch break. So, Shweta decided to walk around and possibly help somebody in their experiments.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../Content/Part06.html" class="navigation navigation-prev " aria-label="Previous page: Decoding Character Device File Operations"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../Content/Part08.html" class="navigation navigation-next " aria-label="Next page: Accessing x86-Specific I/O-Mapped Hardware"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
